const translations = {
    ru: {
        logoText: "–ò–≥—Ä–æ–§–∞–±—Ä–∏–∫–∞",
        projects: "–ü—Ä–æ–µ–∫—Ç—ã",
        about: "–û –Ω–∞—Å",
        contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        heroTitle: "–§–æ—Ä–º–∏—Ä—É–µ–º –±—É–¥—É—â–µ–µ –≤–º–µ—Å—Ç–µ",
        heroSubtitle: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å 2024 –≥–æ–¥–∞",
        viewProjects: "–ù–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã",
        ourGames: "–ù–∞—à–∏ –∏–≥—Ä—ã",
        ourProjects: "–ù–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã",
        aboutText: '–ú—ã –∫—Ä—É—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π –ü–û –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–ò–≥—Ä–æ–§–∞–±—Ä–∏–∫–∞" üòé –ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ –Ω–∞—à—É —Å—Ç–æ—Ä–æ–Ω—É! üòâ.',
        contactText: "–ö–æ–Ω—Ç–∞–∫—Ç—ã: *–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ*",
        copyright: "¬© 2025 –ò–≥—Ä–æ–§–∞–±—Ä–∏–∫–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã",
        socialTitle: "–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö",
        socialVK: "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ",
        socialTG: "Telegram",
        socialYT: "YouTube",
        usefulLinks: "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏",
        linkDocs: "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
        linkBlog: "–ë–ª–æ–≥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤",
        linkCareers: "–í–∞–∫–∞–Ω—Å–∏–∏",
        cooperation: "–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ",
        linksTitle: "–ü–æ–ª–µ–∑–Ω–æ–µ",
        linkPress: "–ü—Ä–µ—Å—Å-—Ü–µ–Ω—Ç—Ä",
        projectTitle: "–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞",
        projectName: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –†–µ–π–Ω–¥–∂–µ—Ä—ã",
        releaseDate: "–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:",
        platforms: "–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:",
        playDemo: "–ò–≥—Ä–∞—Ç—å –≤ –¥–µ–º–æ",
        viewTrailer: "–°–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–µ–π–ª–µ—Ä",
        backToProjects: "‚Üê –ö –ø—Ä–æ–µ–∫—Ç–∞–º",
        viewDetails: "–ü–æ–¥—Ä–æ–±–Ω–µ–µ",
        noProjects: "–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
    },
    en: {
        logoText: "GameFactory",
        projects: "Projects",
        about: "About",
        contact: "Contact",
        heroTitle: "Shaping the future together",
        heroSubtitle: "Professional development since 2024",
        viewProjects: "Our Projects",
        ourProjects: "Our Projects",
        aboutText: 'We are a cool community of creators of software and content "Game Factory" üòé Come over to our side! üòâ.',
        contactText: "Contacts: *Develop*",
        copyright: "¬© 2025 GameFactory. All rights reserved",
        socialTitle: "Follow Us",
        socialVK: "VKontakte",
        socialTG: "Telegram",
        socialYT: "YouTube",
        usefulLinks: "Useful Links",
        linkDocs: "Documentation",
        linkBlog: "Dev Blog",
        linkCareers: "Careers",
        cooperation: "Partnership",
        linksTitle: "Resources",
        linkPress: "Press Center",
        projectTitle: "Project Details",
        projectName: "Space Rangers",
        releaseDate: "Release Date:",
        platforms: "Platforms:",
        playDemo: "Play Demo",
        viewTrailer: "Watch Trailer",
        backToProjects: "‚Üê Back to Projects",
        viewDetails: "View Details",
        noProjects: "No projects found",
    }
};


 // –ó–∞–≥—Ä—É–∑–∫–∞ header
 fetch('./widgets/nav.html')
 .then(response => response.text())
 .then(data => {

    document.getElementById('navbar').innerHTML = data;

    // –ó–∞–≥—Ä—É–∑–∫–∞ footer
    fetch('./widgets/footer.html')
    .then(response => response.text())
    .then(data => {
        document.getElementById('contact').innerHTML = data;
        initSwitches();
        applyTranslations(localStorage.getItem('language'));
    });
 });


 function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
}

function toggleLanguage() {
    //const currentLang = document.documentElement.getAttribute('lang');
    const currentLang = localStorage.getItem('language');
    
    const newLang = currentLang === 'ru' ? 'en' : 'ru';

    document.documentElement.setAttribute('lang', newLang);
    localStorage.setItem('language', newLang);
    applyTranslations(newLang);
    updateLangButton(newLang);
}


function applyTranslations(lang) {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        //console.log(el, key, lang, translations[lang]);
        el.textContent = translations[lang][key];
    });
}

function updateLangButton(lang) {
    //document.querySelector('.lang-toggle').textContent = lang.toUpperCase();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
function initSwitches() {
    const themeToggle = document.getElementById('themeToggle');
    const langToggle = document.getElementById('langToggle');
    
    // –¢–µ–º–∞
    //themeToggle.checked = localStorage.getItem('theme') === 'light';
    //themeToggle.addEventListener('change', toggleTheme);
    
    // –Ø–∑—ã–∫
    langToggle.checked = localStorage.getItem('language') === 'en';
    langToggle.addEventListener('change', toggleLanguage);
}


async function loadProjects() {
    try {
        const response = await fetch('./data/projects.json');
        if (!response.ok) throw new Error('Network error');
        const data = await response.json();
        return data.projects;
    } catch (error) {
        console.error('Error loading projects:', error);
        return [];
    }
}

function renderProjectCard(project, lang) {
    if(project["isEnableView"] == false) return '';
    return `
        <div class="project-card">
            <div class="mini-slider">
                <div class="slides-container">
                    ${project.images.map((img, index) => `
                        <div class="mini-slide ${index === 0 ? 'active' : ''}">
                            <img src="${img}" alt="${project[lang].title}">
                        </div>
                    `).join('')}
                </div>
                <div class="mini-dots">
                    ${project.images.map((_, index) => `
                        <span class="mini-dot ${index === 0 ? 'active' : ''}"></span>
                    `).join('')}
                </div>
            </div>
            <div class="project-info">
                <h3>${project[lang].title}</h3>
                <p>${project[lang].description}</p>
            </div>
            <div class="project-actions">
                <a href="project.html?id=${project.id}" class="btn" data-i18n="viewDetails">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
            </div>
        </div>
    `;
}



// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏-—Å–ª–∞–π–¥–µ—Ä–æ–≤
function initMiniSliders() {
    document.querySelectorAll('.project-card').forEach(card => {
        const slides = card.querySelectorAll('.mini-slide');
        const dots = card.querySelectorAll('.mini-dot');
        let currentSlide = 0;

        // –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
        const autoSlide = () => {
            slides[currentSlide].classList.remove('active');
            dots[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');
        };

        let interval = setInterval(autoSlide, 5000);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–æ—á–µ–∫
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                clearInterval(interval);
                slides[currentSlide].classList.remove('active');
                dots[currentSlide].classList.remove('active');
                currentSlide = index;
                slides[currentSlide].classList.add('active');
                dots[currentSlide].classList.add('active');
                interval = setInterval(autoSlide, 5000);
            });
        });

        // –ü–∞—É–∑–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        card.addEventListener('mouseenter', () => clearInterval(interval));
        card.addEventListener('mouseleave', () => interval = setInterval(autoSlide, 5000));
    });
}

async function BindToggleLanguage() {
    const projects = await loadProjects();
    const lang = localStorage.getItem('language');
    const container = document.querySelector('.projects-grid');

    if(projects.length > 0) {
        container.innerHTML = projects.map(p => renderProjectCard(p, lang)).join('');
        initMiniSliders();
    } else {
        container.innerHTML = '<p data-i18n="noProjects">–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
    }
    applyTranslations(lang);
}




// –í –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
document.addEventListener('DOMContentLoaded', async () => {
    const projects = await loadProjects();
    const lang = localStorage.getItem('language');
    const container = document.querySelector('.projects-grid');

    if(projects.length > 0) {
        container.innerHTML = projects.map(p => renderProjectCard(p, lang)).join('');
        initMiniSliders();
    } else {
        container.innerHTML = '<p data-i18n="noProjects">–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
    }

    const langToggle = document.getElementById('langToggle');
    langToggle.addEventListener('change', BindToggleLanguage);
});

