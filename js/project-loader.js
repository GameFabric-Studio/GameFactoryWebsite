const translations = {
    ru: {
        logoText: "–ò–≥—Ä–æ–§–∞–±—Ä–∏–∫–∞",
        projects: "–ü—Ä–æ–µ–∫—Ç—ã",
        about: "–û –Ω–∞—Å",
        contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
        heroTitle: "–§–æ—Ä–º–∏—Ä—É–µ–º –±—É–¥—É—â–µ–µ –≤–º–µ—Å—Ç–µ",
        heroSubtitle: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å 2024 –≥–æ–¥–∞",
        viewProjects: "–ù–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã",
        ourGames: "–ù–∞—à–∏ –∏–≥—Ä—ã",
        ourProjects: "–ù–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã",
        aboutText: '–ú—ã –∫—Ä—É—Ç–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π –ü–û –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ "–ò–≥—Ä–æ–§–∞–±—Ä–∏–∫–∞" üòé –ü–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ –Ω–∞—à—É —Å—Ç–æ—Ä–æ–Ω—É! üòâ.',
        contactText: "–ö–æ–Ω—Ç–∞–∫—Ç—ã: *–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ*",
        copyright: "¬© 2025 –ò–≥—Ä–æ–§–∞–±—Ä–∏–∫–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã",
        socialTitle: "–ú—ã –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö",
        socialVK: "–í–ö–æ–Ω—Ç–∞–∫—Ç–µ",
        socialTG: "Telegram",
        socialYT: "YouTube",
        usefulLinks: "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏",
        linkDocs: "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
        linkBlog: "–ë–ª–æ–≥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤",
        linkCareers: "–í–∞–∫–∞–Ω—Å–∏–∏",
        cooperation: "–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ",
        linksTitle: "–ü–æ–ª–µ–∑–Ω–æ–µ",
        linkPress: "–ü—Ä–µ—Å—Å-—Ü–µ–Ω—Ç—Ä",
        projectTitle: "–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞",
        projectName: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ –†–µ–π–Ω–¥–∂–µ—Ä—ã",
        releaseDate: "–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞:",
        platforms: "–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:",
        playDemo: "–ò–≥—Ä–∞—Ç—å –≤ –¥–µ–º–æ",
        viewTrailer: "–°–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–µ–π–ª–µ—Ä",
        backToProjects: "‚Üê –ö –ø—Ä–æ–µ–∫—Ç–∞–º",
        viewDetails: "–ü–æ–¥—Ä–æ–±–Ω–µ–µ",
        noProjects: "–ü—Ä–æ–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
    },
    en: {
        logoText: "GameFactory",
        projects: "Projects",
        about: "About",
        contact: "Contact",
        heroTitle: "Shaping the future together",
        heroSubtitle: "Professional development since 2024",
        viewProjects: "Our Projects",
        ourProjects: "Our Projects",
        aboutText: 'We are a cool community of creators of software and content "Game Factory" üòé Come over to our side! üòâ.',
        contactText: "Contacts: *Develop*",
        copyright: "¬© 2025 GameFactory. All rights reserved",
        socialTitle: "Follow Us",
        socialVK: "VKontakte",
        socialTG: "Telegram",
        socialYT: "YouTube",
        usefulLinks: "Useful Links",
        linkDocs: "Documentation",
        linkBlog: "Dev Blog",
        linkCareers: "Careers",
        cooperation: "Partnership",
        linksTitle: "Resources",
        linkPress: "Press Center",
        projectTitle: "Project Details",
        projectName: "Space Rangers",
        releaseDate: "Release Date:",
        platforms: "Platforms:",
        playDemo: "Play Demo",
        viewTrailer: "Watch Trailer",
        backToProjects: "‚Üê Back to Projects",
        viewDetails: "View Details",
        noProjects: "No projects found",
    }
};

 // –ó–∞–≥—Ä—É–∑–∫–∞ header
 fetch('./widgets/nav.html')
 .then(response => response.text())
 .then(data => {

    document.getElementById('navbar').innerHTML = data;

    // –ó–∞–≥—Ä—É–∑–∫–∞ footer
    fetch('./widgets/footer.html')
    .then(response => response.text())
    .then(data => {
        document.getElementById('contact').innerHTML = data;
        initSwitches();
        applyTranslations(localStorage.getItem('language'));

        loadProjectDetails();

        const langToggle = document.getElementById('langToggle');
        langToggle.addEventListener('change', BindToggleLanguageProjectInfo);
    });
 });


 function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
}

function toggleLanguage() {
    //const currentLang = document.documentElement.getAttribute('lang');
    const currentLang = localStorage.getItem('language');
    
    const newLang = currentLang === 'ru' ? 'en' : 'ru';

    document.documentElement.setAttribute('lang', newLang);
    localStorage.setItem('language', newLang);
    applyTranslations(newLang);
    updateLangButton(newLang);
}


function applyTranslations(lang) {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        //console.log(el, key, lang, translations[lang]);
        el.textContent = translations[lang][key];
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π
function initSwitches() {
    const themeToggle = document.getElementById('themeToggle');
    const langToggle = document.getElementById('langToggle');
    
    // –¢–µ–º–∞
    //themeToggle.checked = localStorage.getItem('theme') === 'light';
    //themeToggle.addEventListener('change', toggleTheme);
    
    // –Ø–∑—ã–∫
    langToggle.checked = localStorage.getItem('language') === 'en';
    langToggle.addEventListener('change', toggleLanguage);
}

async function loadProjectDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const projectId = urlParams.get('id');

    if(!projectId) {
        window.location.href = 'index.html';
        return;
    }

    try {
        const response = await fetch('./data/projects.json');
        const data = await response.json();
        const project = data.projects.find(p => p.id == projectId);
        
        if(!project) throw new Error('Project not found');
        renderProjectDetails(project);
    } catch (error) {
        console.error('Error:', error);
        //window.location.href = 'index.html';
    }
}

function renderProjectDetails(project) {
    if(project["isEnableView"] == false) return;
    console.log(project);
    const lang = localStorage.getItem('language');
    const container = document.getElementById('project-container');
    
    
    fetch(project[lang]['render-description'])
    .then(response => response.text())
    .then(render_description => {
        console.log(render_description);
        const html = `
        <div class="project-slider">
            ${renderSlider(project.images)}
        </div>

        <div class="project-info">
            <h1>${project[lang].title}</h1>
            <div class="project-meta">
                <span>${project[lang].release_date}</span>
                <span>${project[lang].platforms}</span>
            </div>
            <p class="project-description">${render_description}</p>
            
            <div class="project-links">
                <!-- <a href="${project.links.demo}" class="btn" data-i18n="playDemo">–ò–≥—Ä–∞—Ç—å –≤ –¥–µ–º–æ</a>-->
                <!-- <a href="${project.links.trailer}" class="btn" data-i18n="viewTrailer">–°–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–µ–π–ª–µ—Ä</a>-->
                <a href="index.html#projects" class="btn back-btn" data-i18n="backToProjects">‚Üê –ö –ø—Ä–æ–µ–∫—Ç–∞–º</a>
            </div>
        </div>
        `;

        container.innerHTML = html;
        applyTranslations(lang); // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã
        initSlider(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞
    });


}

function renderSlider(images) {
    return `
        <div class="slides">
            ${images.map((img, index) => {
                if(index == 0) 
                    return `<div class="slide active">
                                <img src="${img}" alt="–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞">
                            </div>`; 
                else return `<div class="slide">
                                <img src="${img}" alt="–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞">
                            </div>`;
            }).join('')}
            <button class="slider-btn prev">‚ùÆ</button>
            <button class="slider-btn next">‚ùØ</button>
        </div>
        <div class="dots"></div>
    `;
}


function initSlider(){
    const slides = document.querySelectorAll('.slide');
    const dotsContainer = document.querySelector('.dots');
    let currentSlide = 0;

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–µ–∫
    slides.forEach((_, idx) => {
        const dot = document.createElement('div');
        dot.classList.add('dot');
        if(idx === 0) dot.classList.add('active');
        dot.addEventListener('click', () => changeSlide(idx));
        dotsContainer.appendChild(dot);
    });

    // –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    document.querySelector('.prev').addEventListener('click', () => {
        changeSlide(currentSlide - 1);
    });

    document.querySelector('.next').addEventListener('click', () => {
        changeSlide(currentSlide + 1);
    });

    function changeSlide(n) {
        currentSlide = (n + slides.length) % slides.length;
        slides.forEach((slide, idx) => {
            slide.classList.toggle('active', idx === currentSlide);
        });
        document.querySelectorAll('.dot').forEach((dot, idx) => {
            dot.classList.toggle('active', idx === currentSlide);
        });
    }
}


async function BindToggleLanguageProjectInfo() {
    const lang = localStorage.getItem('language');
    loadProjectDetails();
    applyTranslations(lang);
}